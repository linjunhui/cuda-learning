# 内存池设计面试题总览

本目录包含基于当前 `FixedSizePool` 实现的内存池设计相关面试题。

## 题目分类

### 01-内存池基础概念题.md
**难度范围：⭐⭐ - ⭐⭐⭐**

基础概念类题目，适合考察对内存池基本知识的理解：
- 内存池的基本概念和优势
- 固定大小 vs 可变大小内存池
- BlockHeader 的作用和设计
- 内存对齐的重要性
- 空闲链表的设计原理

**适合人群**：初级到中级开发者

---

### 02-内存池设计思路题.md
**难度范围：⭐⭐⭐ - ⭐⭐⭐⭐⭐**

设计思路类题目，考察系统设计能力：
- 内存池的整体架构设计
- 生命周期管理
- 扩容策略
- 初始化策略
- 多级内存池设计
- 错误处理机制

**适合人群**：中级到高级开发者

---

### 03-内存池实现细节题.md
**难度范围：⭐⭐⭐ - ⭐⭐⭐⭐**

实现细节类题目，考察编程实现能力：
- allocate() 函数实现
- deallocate() 函数实现
- 指针验证和边界检查
- 用户指针到块头部的转换
- 线程安全的实现
- 内存对齐的计算

**适合人群**：中级开发者

---

### 04-内存池性能优化题.md
**难度范围：⭐⭐⭐ - ⭐⭐⭐⭐⭐**

性能优化类题目，考察性能优化能力：
- 减少内存碎片
- 缓存友好的内存布局
- 分配器性能对比
- 批量分配优化
- 内存预取（Prefetching）
- 内存池大小的选择

**适合人群**：高级开发者

---

### 05-内存池线程安全题.md
**难度范围：⭐⭐⭐ - ⭐⭐⭐⭐⭐**

线程安全类题目，考察并发编程能力：
- 互斥锁 vs 读写锁
- 无锁内存池设计
- 线程本地存储（TLS）优化
- 内存屏障和内存序
- 死锁预防
- 原子操作的正确使用

**适合人群**：高级开发者

---

### 06-内存池扩展设计题.md
**难度范围：⭐⭐⭐ - ⭐⭐⭐⭐⭐**

扩展设计类题目，考察系统扩展能力：
- 实现标准分配器接口
- 可变大小内存池设计
- 内存池的监控和统计
- 内存池的调试支持
- 分层内存池设计
- 性能分析工具

**适合人群**：高级到专家级开发者

---

## 当前内存池实现概览

### 核心组件

1. **FixedSizePool**
   - 固定大小的内存池
   - 使用空闲链表管理空闲块
   - 使用互斥锁保证线程安全
   - 支持统计信息跟踪

2. **BlockHeader**
   - 内存块元数据结构
   - 包含大小、状态、链表指针
   - 使用魔数检测内存损坏
   - 支持分配统计

### 设计特点

- ✅ 固定大小，O(1) 分配/释放
- ✅ 线程安全（使用互斥锁）
- ✅ 内存对齐
- ✅ 错误检测（magic number）
- ✅ 统计信息跟踪

### 待完善功能

- ⚠️ 缺少析构函数
- ⚠️ initialize_blocks() 需要手动调用
- ⚠️ 缺少 allocate/deallocate 实现
- ⚠️ 池满时无法扩容

---

## 使用建议

### 面试官
1. 根据候选人级别选择合适的题目类别
2. 可以从基础概念开始，逐步深入
3. 鼓励候选人分析当前实现的优缺点
4. 可以要求候选人实现某些缺失的功能

### 候选人
1. 先理解当前的内存池实现
2. 思考每个设计决策的原因
3. 尝试实现缺失的功能
4. 考虑性能优化和扩展性

---

## 相关文件

- `include/StringProcessingLib/memory_pool/fixed_size_pool.h` - 内存池头文件
- `src/memory_pool/fixed_size_pool.cpp` - 内存池实现
- `include/StringProcessingLib/memory_pool/block_header.h` - 块头部定义
- `tests/unit_tests/memory_pool/test_fixed_size_pool.cpp` - 单元测试

---

## 题目统计

- **总题目数**：30+ 道
- **难度分布**：
  - ⭐⭐：5 道
  - ⭐⭐⭐：12 道
  - ⭐⭐⭐⭐：10 道
  - ⭐⭐⭐⭐⭐：3 道

---

## 扩展学习

- [jemalloc 源码分析](https://github.com/jemalloc/jemalloc)
- [tcmalloc 设计文档](https://github.com/google/tcmalloc)
- [内存池最佳实践](https://www.boost.org/doc/libs/1_82_0/libs/pool/doc/html/index.html)
