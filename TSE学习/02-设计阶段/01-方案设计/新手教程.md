# 设计评估 - 新手教程

## 📖 什么是设计评估？

设计评估就是：**评审设计方案，看设计是否合理，能否实现，并提出改进建议**。

### 简单理解

**设计评审**就像：
- 建筑师设计房子图纸
- 你作为质检员检查图纸
- 发现问题："这里缺少逃生通道"（可测试性需求）
- 提出建议："应该在这里加一个门"

### 为什么要进行设计评估？

**没有设计评估**：
```
开发人员："我这样设计应该没问题"
开发完成后："哦，这个功能很难测试..."
测试人员："这个功能我无法测试，因为没有测试接口"
→ 返工，重新设计
```

**有设计评估**：
```
设计评审时：
测试人员："这个功能缺少日志输出，我无法判断是否正常"
开发人员："好的，我添加日志接口"
→ 提前发现问题，设计时考虑测试需求
→ 避免返工
```

---

## 第一部分：参与设计评审（1级）

### 1.1 什么是设计评审？

**设计评审** = 大家一起看设计方案，找出问题，提出建议

**评审流程**：
```
1. 设计人员展示设计方案
   ↓
2. 评审人员（包括你）查看设计
   ↓
3. 提出问题和建议
   ↓
4. 讨论解决方案
   ↓
5. 修改设计文档
```

### 1.2 如何参与设计评审？

#### 步骤1：提前准备

**评审前要做的事**：
1. **阅读设计文档**
   - 理解设计方案
   - 找出不理解的地方
   - 准备问题

2. **理解需求**
   - 看看需求文档
   - 理解要实现什么功能
   - 理解用户场景

3. **准备评审清单**
   - 使用检查清单
   - 系统化地检查设计

#### 步骤2：评审时关注什么？

**测试人员关注点**：

1. **可测试性**
   - 这个功能容易测试吗？
   - 有足够的测试接口吗？
   - 有日志可以帮助排查吗？

2. **完整性**
   - 设计覆盖了所有需求吗？
   - 异常情况考虑了吗？

3. **正确性**
   - 设计符合需求吗？
   - 设计逻辑正确吗？

**例子**：

**设计方案**：
```
登录功能设计：
  - 用户输入用户名和密码
  - 系统验证
  - 返回成功/失败
```

**你的评审意见**：
```
问题1：缺少日志
  建议：添加登录成功/失败的日志，方便测试和排查

问题2：缺少错误码
  建议：不同的错误返回不同的错误码，方便测试判断

问题3：没有考虑并发
  建议：考虑多用户同时登录的情况
```

#### 步骤3：提出有效评审意见

**有效评审意见的特征**：
- ✅ **具体**：指出具体的问题点
- ✅ **可行**：提出的建议可以实现
- ✅ **有价值**：能帮助改进设计

**例子对比**：

❌ **无效意见**：
```
"这个设计不太好"
→ 太模糊，不知道哪里不好
```

✅ **有效意见**：
```
"登录失败时缺少错误码，建议添加错误码：
  - 密码错误：ERR_PASSWORD_WRONG
  - 用户名不存在：ERR_USER_NOT_FOUND
  这样可以方便测试和错误定位"
→ 具体、可行、有价值
```

---

## 第二部分：提出改进建议（2级）

### 2.1 如何识别需要改进的地方？

**关注点**：

1. **性能问题**
   - 设计可能导致性能问题吗？
   - 有没有优化空间？

2. **安全问题**
   - 设计有安全漏洞吗？
   - 数据安全考虑了吗？

3. **可维护性**
   - 设计容易维护吗？
   - 代码结构合理吗？

4. **可测试性**
   - 容易测试吗？
   - 测试友好吗？

**例子**：发现性能问题

**设计方案**：
```
用户查询功能：
  每次查询都访问数据库，获取所有数据
```

**你的改进建议**：
```
问题：每次都查询所有数据，性能差

建议：
  1. 添加缓存机制，减少数据库访问
  2. 分页查询，只获取需要的数据
  3. 添加索引，提高查询速度

预期效果：
  - 查询响应时间从5秒降低到1秒
  - 数据库压力降低80%
```

### 2.2 如何让建议被采纳？

**技巧**：

1. **说明原因**
   - 为什么要改进？
   - 不改会有什么问题？

2. **提供方案**
   - 具体怎么改进？
   - 改进后的好处？

3. **评估成本**
   - 改进需要多少工作量？
   - 是否值得投入？

**例子**：可测试性改进建议

**当前设计**：
```
功能：处理订单
设计：订单处理是内部流程，不提供外部接口
```

**你的建议**：
```
问题：订单处理没有外部接口，无法进行单元测试和集成测试

建议：添加测试接口
  - 提供Mock接口用于测试
  - 添加日志输出，记录处理过程
  - 添加状态查询接口

理由：
  1. 没有测试接口，无法自动化测试
  2. 手动测试效率低，容易遗漏
  3. 出现问题难以排查

成本评估：
  - 工作量：2天
  - 收益：测试效率提高，质量提升
  - 值得投入 ✅
```

---

## 第三部分：提出可测试性需求（3级）

### 3.1 什么是可测试性需求？

**可测试性** = 功能是否容易测试

**可测试性需求** = 为了让功能容易测试，需要设计时考虑的需求

**例子**：

**没有可测试性需求**：
```
功能：自动发送邮件
设计：发送邮件是内部实现，没有外部接口
问题：无法测试邮件是否发送成功
```

**有了可测试性需求**：
```
需求：添加邮件发送状态查询接口
  输入：邮件ID
  输出：发送状态（成功/失败/发送中）
价值：方便测试验证邮件是否发送成功
```

### 3.2 如何识别可测试性需求？

#### 识别方法1：现场部署场景

**问题**：系统部署到现场后，如何验证功能正常？

**例子**：
```
功能：定时任务执行
现场场景：部署到客户环境后，如何知道定时任务是否正常执行？

可测试性需求：
  1. 添加执行日志，记录每次执行时间和结果
  2. 提供状态查询接口，可以查询任务状态
  3. 添加监控告警，任务失败时发送告警
```

#### 识别方法2：应用场景

**问题**：在实际使用场景中，如何测试？

**例子**：
```
功能：用户支付
应用场景：支付成功后，如何验证支付状态？

可测试性需求：
  1. 提供支付状态查询接口
  2. 提供支付日志查询
  3. 提供测试支付接口（用于测试环境）
```

### 3.3 常见的可测试性需求

**类型1：日志和监控**
- 关键操作需要记录日志
- 提供日志查询接口
- 添加性能监控点

**类型2：测试接口**
- 提供Mock接口
- 提供测试数据注入接口
- 提供状态查询接口

**类型3：配置和开关**
- 提供功能开关（可以关闭某些功能用于测试）
- 提供测试模式
- 提供调试接口

**例子**：完整的可测试性需求

```
功能：订单处理

可测试性需求：
  1. 日志需求：
     - 记录订单创建时间、处理时间
     - 记录每个处理步骤的结果
     - 记录错误信息和堆栈

  2. 接口需求：
     - 提供订单状态查询接口
     - 提供订单详情查询接口
     - 提供测试订单创建接口

  3. 监控需求：
     - 提供订单处理时长监控
     - 提供失败率监控
     - 提供异常告警

  4. 配置需求：
     - 可以配置处理超时时间（用于测试）
     - 可以关闭某些检查（用于测试）
```

---

## 第四部分：实战教程

### 实战案例：评审"用户登录"功能设计

#### 第一步：阅读设计方案

**设计方案**：
```
功能：用户登录
设计：
  1. 用户输入用户名和密码
  2. 系统验证用户名和密码
  3. 验证成功，创建Session
  4. 返回登录结果
```

#### 第二步：识别问题（1级）

**你的评审意见**：
```
问题1：缺少错误处理
  - 密码错误怎么处理？
  - 账号被锁定怎么处理？

问题2：缺少日志
  - 登录成功/失败没有日志，无法排查问题

问题3：安全性考虑不足
  - 没有考虑暴力破解
  - 没有考虑会话安全
```

#### 第三步：提出改进建议（2级）

**你的改进建议**：
```
建议1：添加错误处理
  - 返回明确的错误码和错误信息
  - 连续失败3次锁定账号

建议2：添加日志
  - 记录登录成功/失败
  - 记录IP地址和时间
  - 记录账号锁定事件

建议3：增强安全性
  - 添加验证码（失败3次后）
  - Session设置过期时间
  - 支持HTTPS
```

#### 第四步：提出可测试性需求（3级）

**可测试性需求**：
```
需求1：登录状态查询接口
  用途：测试时可以查询用户是否登录
  接口：GET /api/user/login-status

需求2：登录日志查询接口
  用途：测试时可以查看登录日志
  接口：GET /api/log/login?user=xxx

需求3：测试账号解锁接口
  用途：测试时可以手动解锁账号
  接口：POST /api/test/unlock-account?user=xxx

需求4：Mock登录接口
  用途：测试环境可以使用Mock接口
  接口：POST /api/test/mock-login
```

**价值**：
- 测试时可以验证登录功能
- 可以自动化测试
- 可以排查问题
- 提高测试效率

---

## 第五部分：学习检查清单

### 1级能力 ✅
- [ ] 我能参与设计评审
- [ ] 我能提出有效的评审意见
- [ ] 我理解设计评审的流程

### 2级能力 ✅
- [ ] 我能识别设计中的问题
- [ ] 我能提出改进建议
- [ ] 我的建议能被采纳

### 3级能力 ✅
- [ ] 我能识别可测试性需求
- [ ] 我能提出具体的可测试性需求
- [ ] 我的需求能被采纳

---

## 常见问题

### Q1：设计评审时不知道说什么？

**A**：
- 从测试角度思考：这个功能怎么测试？
- 从用户角度思考：用户会怎么用？
- 从系统角度思考：会不会有问题？

### Q2：如何判断建议是否有价值？

**A**：
- 能解决实际问题
- 能提高质量
- 成本合理

### Q3：如何学习可测试性设计？

**A**：
- 多参与设计评审
- 学习测试驱动开发（TDD）
- 学习测试友好的设计原则

---

**继续学习**：
- [设计评估实践案例](./实践案例/)
- [02-测试设计](../03-测试阶段/02-测试设计/README.md)




